--- 
wordpress_id: 1453
layout: post
title: Annoyances of the Feature Kind
wordpress_url: http://passingcuriosity.com/2005/annoyances-of-the-feature-kind/
---
Yesterday, I finally sat down and wrote a priority queue (a <a href="http://en.wikipedia.org/wiki/Heap">heap</a> to those in the know) to store the formulae on a branch that still need to be processed. Chris Okasaki (in his book <a href="http://www.eecs.usma.edu/Personnel/okasaki/pubs.html#cup98">Purely Functional Data Structures</a>) defines the interface of a heap as follows:<br /><br /><code><span class="keyword">class</span> Heap h <span class="keyword">where</span><code style="border: none;">    empty     <span class="keyword">::</span> (<span class="keyword">Ord</span> a) <span class="keyword">=&gt;</span> h a<br />  isEmpty   <span class="keyword">::</span> (<span class="keyword">Ord</span> a) <span class="keyword">=&gt;</span> h a <span class="keyword">-&gt;</span> Bool<br /><br />  insert    <span class="keyword">::</span> (<span class="keyword">Ord</span> a) <span class="keyword">=&gt;</span> a <span class="keyword">-&gt;</span> h a <span class="keyword">-&gt;</span> h a<br />  merge     <span class="keyword">::</span> (<span class="keyword">Ord</span> a) <span class="keyword">=&gt;</span> h a <span class="keyword">-&gt;</span> h a <span class="keyword">-&gt;</span> h a<br /><br />  findMin   <span class="keyword">::</span> (<span class="keyword">Ord</span> a) <span class="keyword">=&gt;</span> h a <span class="keyword">-&gt;</span> a<br />  deleteMin <span class="keyword">::</span> (<span class="keyword">Ord</span> a) <span class="keyword">=&gt;</span> h a <span class="keyword">-&gt;</span> h a<br /></code></code><br /><br />This is a problem (in my opinion) in that it requires that heaps (all heaps) be over ordered data-types. The entire <emph>reason</emph> that I am attempting to extend the heap is to remove the ordering from the contained type, and use a priority type instead. Thus we are no longer saying that, for example, <code style="text-align: center;">? &lt; ?</code> but that <code style="text-align: center;">(priority ?) &lt; (priority ?)</code><br /><br />I'll be the first to admit that this isn't much of a distinction to make (especially from a pragmatic "programmer" point of view), but it is a nicer approach.<br /><br />I got around this problem, such as it is, by modifying my Prioritised class to have a function to inject values into my Priority type and one to extract them. The heap then is a type synonym:<code style="text-align: center;"><span class="keyword">type</span> PriorityHeap t <span class="keyword">=</span> LeftistHeap (Priority t)</code> with the restriction that you need to explicitly wrap values you insert into a heap:<code style="text-align: center;"><span class="keyword">let</span> h' <span class="keyword">=</span> insert (priority v) h <span class="keyword">in</span> ...</code> and unwrap those you get out: <code style="text-align: center;"><span class="keyword">let</span> v <span class="keyword">=</span> value <span class="keyword">$</span> findMin h' <span class="keyword">in</span> ...</code><br /><br />Not terribly inconvenient, but not ideal. I'm fairly sure that this could be solved with some functional dependancies magic, but the current state of affairs is good enough to be getting on with.
